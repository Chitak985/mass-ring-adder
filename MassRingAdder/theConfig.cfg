@Kopernicus:FINAL                                                                      // Initial allowRing and settings accessibility 
{
	@Body,*                                                                            // Apply to every single Body
	{
		allowRing = true                                                               // Allow adding a ring by default
		configWasHere = false                                                          // Variable to know if a config was applied
		ignoreWithRings = #$/@MassRingAdderSettings/ignoreWithRings$
		ignoreIncompatible = #$/@MassRingAdderSettings/ignoreIncompatible$
		overrideOnAll = #$/@MassRingAdderSettings/overrideOnAll$
		overrideOffAll = #$/@MassRingAdderSettings/overrideOffAll$
		proceduralRings = #$/@MassRingAdderSettings/proceduralRings$
	}
}
@Kopernicus:FINAL                                                                      // All bodies that are not incompatible will be marked compatible
{
	@Body,*:HAS[!#MRAincompatible[?rue]]
	{
		&MRAincompatible = false                                                       // Add MRAincompatible if it does not exist
	}
}
@Kopernicus:FINAL                                                                      // Do not add rings if rings are present (unless overriden)
{
	@Body,*:HAS[@Rings,*&#ignoreWithRings[?rue]]
	{
		@allowRing = false                                                             // Do not add a ring
	}
}
@Kopernicus:FINAL                                                                      // Do not add rings if incompatible (unless overriden)
{
	@Body,*:HAS[#MRAincompatible[?rue]&#ignoreIncompatible[?rue]]
	{
		@allowRing = false                                                             // Do not add a ring
	}
}
@Kopernicus:FINAL                                                                      // Override: all on (must be compatible)
{
	@Body,*:HAS[#overrideOnAll[?rue]&#MRAincompatible[?alse]&#ignoreIncompatible[?rue]]
	{
		@allowRing = true                                                              // Do add a ring
	}
}
@Kopernicus:FINAL                                                                      // Override: all on (overriden to allow anything)
{
	@Body,*:HAS[#overrideOnAll[?rue]&&#ignoreIncompatible[?alse]]
	{
		@allowRing = true                                                              // Do add a ring
	}
}
@Kopernicus:FINAL                                                                      // Override: all off (overrides everything, other overrides do not matter)
{
	@Body,*:HAS[#overrideOffAll[?rue]]
	{
		@allowRing = false                                                             // Do not add a ring
	}
}

@Kopernicus:FINAL                                                                      // -----Config Rings-----
{
	@Body,*:HAS[@RINGBODY&#allowRing[true]]                                            // Add rings if a configuration is present and ring is allowed
	{
		@configWasHere = true                                                          // Mark Body as already processed by a config - no procedural ring needed
		@RINGBODY,0                                                                    // Ignore all RINGBODY other than the first
		{
			|_ = RINGBODYREAL                                                          // Rename to avoid deletion
		}
		!RINGBODY,* {}                                                                 // Delete useless RINGBODY
		%Rings                                                                         // Add new rings or add them to an existing set
		{
			Ring                                                                       // Add the Ring using data from the configuration
			{
				innerRadius = #$../../RINGBODYREAL/innerRadius$                        // Load innerRadius
				outerRadius = #$../../RINGBODYREAL/outerRadius$                        // Load outerRadius

				InnerRadiusMultiplier                                                  // Default value from wiki
				{
						key = 0 1 0 0                                                  // Default value from wiki
				}
				OuterRadiusMultiplier                                                  // Default value from wiki
				{
						key = 0 1 0 0                                                  // Default value from wiki
				}
			
				thickness = #$../../RINGBODYREAL/thickness$                            // Load thickness
				steps = 120                                                            // Default value from wiki

				texture = MassRingAdder/MainRing.dds                                   // Use default custom ring texture
				tiles = 10                                                             // Default value from wiki
				color = #$../../RINGBODYREAL/color$                                    // Load color
				unlit = false                                                          // Default value from wiki
				useNewShader = false                                                   // Default value from wiki
				penumbraMultiplier = 200                                               // Default value from wiki

				angle = #$../../RINGBODYREAL/inclination$                              // Load ring angle
				lockRotation = false                                                   // Default value from wiki
				rotationPeriod = 100                                                   // Default value that I chose for no reason
			}
		}
	}
}

@Kopernicus:FINAL                                                                      // ----- Procedural Rings -----
{
	@Body,*:HAS[#configWasHere[false]&#proceduralRings[?rue]&#allowRing[true]]         // Creates a procedural ring if all conditions are met
	{
		%Rings                                                                         // Add new rings or add them to an existing set
		{
			Ring                                                                       // Add a procedural ring
			{
				innerRadius = 2000                                                     // Value I picked for no reason
				outerRadius = 5000                                                     // Value I picked for no reason

				InnerRadiusMultiplier                                                  // Default value from wiki
				{
						key = 0 1 0 0                                                  // Default value from wiki
				}
				OuterRadiusMultiplier                                                  // Default value from wiki
				{
						key = 0 1 0 0                                                  // Default value from wiki
				}
			
				thickness = 100                                                        // Default value from wiki
				steps = 120                                                            // Default value from wiki

				texture = MassRingAdder/MainRing1.dds                                  // Use ring texture for procedural rings
				tiles = 10                                                             // Default value from wiki
				color = 0.9, 0.9, 0.9, 0.9                                             // Default is white, but will be replaced next
				unlit = false                                                          // Default value from wiki
				useNewShader = false                                                   // Default value from wiki
				penumbraMultiplier = 200                                               // Default value from wiki

				angle = 10                                                             // Would be changed later in a patch sometime
				lockRotation = false                                                   // Default value from wiki
				rotationPeriod = 100                                                   // Default value that I chose for no reason
			}
		}
	}
}
